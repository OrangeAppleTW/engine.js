!function(t){function e(s){if(i[s])return i[s].exports;var o=i[s]={exports:{},id:s,loaded:!1};return t[s].call(o.exports,o,o.exports,e),o.loaded=!0,o.exports}var i={};return e.m=t,e.c=i,e.p="",e(0)}([function(t,e,i){function s(t,e){function i(t){return t.width&&(p.width=m.width=t.width),t.height&&(p.height=m.height=t.height),t.zoom&&(m.zoom=t.zoom,p.style.width=p.width*m.zoom+"px",p.style.height=p.height*m.zoom+"px"),m.gravity=t.gravity||m.gravity,m.update=t.update||m.update,this}function s(t,e,i,s,o){F.path=t,F.x=e,F.y=i,F.w=s,F.h=o}var p=document.getElementById(t),f=p.getContext("2d"),m={width:p.width,height:p.height,zoom:1,updateFunctions:[]},g=new d,y=new n,w=new h,v=new l(p,m,e),x=new r(v,e),k=new u(f,m,g.images,e),_=new c(g.sounds,e),N=new a(function(){F.path&&k.drawBackdrop(F.path,F.x,F.y,F.w,F.h),x.traverse();for(var t=0;t<m.updateFunctions.length;t++)m.updateFunctions[t]();y.removeDeletedSprites(),y.runOnTick(),w.updateFPS(),k.drawSprites(y),k.drawTexts()}),F={path:"#ffffff"};e=e||!1;var S=function(t,e,i){["keydown","keyup","mousedown","mouseup","holding","click"].includes(t)&&("function"==typeof e?x.register(t,null,e):x.register(t,e,i))},T={createSprite:function(t){var e=new o(t,x,m,k);return y._sprites.push(e),y._sprites.sort(function(t,e){return t.layer-e.layer}),e},print:k.print,setBackground:s,setBackdrop:s,cursor:v.cursor,key:v.holding,inspector:w,when:S,on:S,set:i,stop:function(){N.stop(),_.stop()},start:function(){N.start()},update:function(t){m.updateFunctions.push(t)},always:function(t){m.updateFunctions.push(t)},forever:function(t){m.updateFunctions.push(t)},ctx:f,clear:function(){k.clear()},preload:function(t,e,i){g.preload(t,e,i)},sound:_,broadcast:x.emit.bind(x),drawBackdrop:function(t,e,i,s,o){k.drawBackdrop(t,e,i,s,o)},drawSprites:function(){k.drawSprites(y)}};return e&&(T.eventList=x),T}var o=i(1),n=i(3),r=i(4),h=i(5),a=i(6),u=i(7),c=i(8),d=i(9),l=i(10);window.Engine=s},function(t,e,i){function s(t,e,i,s){t.constructor!==String&&t.constructor!==Array||(t={costumes:[].concat(t)}),this.x=n.isNumeric(t.x)?t.x:i.width/2,this.y=n.isNumeric(t.y)?t.y:i.height/2,this.width=1,this.height=1,this.direction=t.direction||0,this.rotationStyle=t.rotationStyle||"full",this.scale=t.scale||1,this.costumes=[].concat(t.costumes),this.hidden=t.hidden||!1,this.layer=n.isNumeric(t.layer)?t.layer:0,this.opacity=n.isNumeric(t.opacity)?t.opacity:1,this.costumeId=0,this._onTickFuncs=[],this._deleted=!1,this._eventList=e,this._settings=i,this._renderer=s,this._animation={frames:[],rate:5,timer:0}}function o(t,e){if(this.hidden)return!1;var i=crossY=!1;if(arguments[0]instanceof s){if(this==arguments[0])return!1;if(arguments[0].hidden)return!1;var o=arguments[0];if(o._deleted)return!1;i=this.x+this.width/2>o.x-o.width/2&&o.x+o.width/2>this.x-this.width/2,crossY=this.y+this.height/2>o.y-o.height/2&&o.y+o.height/2>this.y-this.height/2}else if(n.isNumeric(arguments[0].x)&&n.isNumeric(arguments[0].y)){var a=arguments[0].x,u=arguments[0].y;i=this.x+this.width/2>a&&a>this.x-this.width/2,crossY=this.y+this.height/2>u&&u>this.y-this.height/2}else{if(!n.isNumeric(arguments[0])||!n.isNumeric(arguments[1]))throw"請傳入角色(Sprite)、{x:x, y:y}，或是 X, Y 坐標值";var a=arguments[0],u=arguments[1];i=this.x+this.width/2>a&&a>this.x-this.width/2,crossY=this.y+this.height/2>u&&u>this.y-this.height/2}if(i&&crossY){var c=this._renderer,d=this._settings;if(r.width=d.width,r.height=d.height,!this._renderer)return console.log(this);if(h.globalCompositeOperation="source-over",h.drawImage(c.getImgFromCache(this.getCurrentCostume()),this.x-this.width/2,this.y-this.height/2,this.width,this.height),h.globalCompositeOperation="source-in",arguments[0]instanceof s){var o=arguments[0];h.drawImage(c.getImgFromCache(o.getCurrentCostume()),o.x-o.width/2,o.y-o.height/2,o.width,o.height)}else if(n.isNumeric(arguments[0].x)&&n.isNumeric(arguments[0].y))h.fillRect(arguments[0].x,arguments[0].y,1,1);else{if(!n.isNumeric(arguments[0])||!n.isNumeric(arguments[1]))return!1;h.fillRect(arguments[0],arguments[1],1,1)}for(var l=h.getImageData(this.x-this.width/2,this.y-this.height/2,this.width,this.height).data,p=l.length,f=0;f<p;f+=4)if(l[f+3]>0)return!0}return!1}var n=i(2),r=document.createElement("canvas"),h=r.getContext("2d");s.prototype.update=function(){this._updateDirection(),this._updateFrames();for(var t=0;t<this._onTickFuncs.length;t++)this._onTickFuncs[t].call(this)},s.prototype._updateDirection=function(){this.direction=this.direction%360,this.direction<0&&(this.direction+=360)},s.prototype._updateFrames=function(){var t=this._animation;if(t.frames.length>0){var e=(new Date).getTime();e>=t.timer+1e3/t.rate&&(t.timer=e,this.costumeId=t.frames.shift(),t.frames.length<=0&&t.callback&&t.callback())}},s.prototype.moveTo=function(t,e){this.x=t,this.y=e},s.prototype.move=function(t,e){this.x+=t,this.y+=e},s.prototype.stepForward=function(t){var e=n.degreeToRad(this.direction);this.x+=Math.sin(e)*t,this.y-=Math.cos(e)*t},s.prototype.toward=function(){var t,e,i,s,o;if(n.isNumeric(arguments[0].x)&&n.isNumeric(arguments[0].y))t=arguments[0].x,e=arguments[0].y;else{if(!n.isNumeric(arguments[0])||!n.isNumeric(arguments[1]))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t=arguments[0],e=arguments[1]}i=t-this.x,s=e-this.y,o=Math.atan2(i,-s),this.direction=n.radToDegree(o)},s.prototype.touched=function(){if(arguments[0].constructor===Array){for(var t=0;t<arguments[0].length;t++)if(o.call(this,arguments[0][t]))return!0;return!1}return o.apply(this,arguments)},s.prototype.distanceTo=function(){return n.isNumeric(arguments[0].x)&&n.isNumeric(arguments[0].y)?n.distanceBetween(this,arguments[0]):n.isNumeric(arguments[0])&&n.isNumeric(arguments[1])?n.distanceBetween(this.x,this.y,arguments[0],arguments[1]):void 0},s.prototype.always=s.prototype.forever=function(t){this._onTickFuncs.push(t)},s.prototype.when=s.prototype.on=function(){var t=arguments[0],e=this._eventList;return"listen"==t?e.register(t,arguments[1],this,arguments[2]):["mousedown","mouseup","hover","click"].includes(t)?e.register(t,this,arguments[1]):"touch"==t?e.register(t,this,arguments[1],arguments[2]):(console.log('Sprite.on() does only support "listen", "click", hover" and "touch" events'),!1)},s.prototype.destroy=function(){this._deleted=!0},s.prototype.getCurrentCostume=function(){var t=this.costumeId;return this.costumes[t]},s.prototype.animate=function(t,e,i){this._animation={frames:t,rate:e||5,callback:i,timer:0}},s.prototype.nextCostume=function(){this.costumeId+=1,this.costumeId>=this.costumes.length&&(this.costumeId=0)},t.exports=s},function(t,e){var i={};i.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},i.radToDegree=function(t){return t%=2*Math.PI,t<0&&(t+=2*Math.PI),180*t/Math.PI},i.degreeToRad=function(t){return t%=360,t<0&&(t+=360),t/180*Math.PI},i.distanceBetween=function(){var t={x:0,y:0},e={x:0,y:0};if(i.isNumeric(arguments[0].x)&&i.isNumeric(arguments[0].y)&&i.isNumeric(arguments[1].x)&&i.isNumeric(arguments[1].y))t.x=arguments[0].x,t.y=arguments[0].y,e.x=arguments[1].x,e.y=arguments[1].y;else{if(!(i.isNumeric(arguments[0])&&i.isNumeric(arguments[1])&&i.isNumeric(arguments[2])&&i.isNumeric(arguments[3])))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t.x=arguments[0],t.y=arguments[1],e.x=arguments[2],e.y=arguments[3]}return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},t.exports=i},function(t,e){function i(){this._sprites=[]}i.prototype.runOnTick=function(){this.each(function(){this.update()})},i.prototype.each=function(t){for(var e=this._sprites,i=0;i<e.length;i++)t.call(e[i],e[i])},i.prototype.removeDeletedSprites=function(){for(var t=this._sprites,e=0;e<t.length;e++)t[e]._deleted&&t.splice(e,1)},i.prototype.clear=function(){this._sprites=[]},t.exports=i},function(t,e){function i(t,e){this.pool=[],this.messages=[],this.io=t,this.debugMode=e||!1}function s(t,e,i,s){t.touched(i)&&(e.call(t),s&&console.log("Just fired a hover handler at: ("+i.x+","+i.y+")"))}function o(t,e,i,s){i.x&&i.y&&(t?t.touched(i.x,i.y)&&(e.call(t),s&&console.log("Just fired a click handler on a sprite! ("+JSON.stringify(i)+")")):(e(),s&&console.log("Just fired a click handler on stage! ("+JSON.stringify(i)+")")))}function n(t,e,i,s){i[t]&&(e(),s&&console.log("Just fired a keydown handler on: "+t))}function r(t,e,i,s){i[t]&&(e(),s&&console.log("Just fired a holding handler on: "+t))}function h(t,e,i,s,o){i.includes(s)&&e.call(t)}function a(t,e,i,s){for(var o,n=0;o=i[n];n++)t.touched(o)&&(e.call(t,o),s&&console.log({event:"Touch",sprite:t,target:o}))}i.prototype.traverse=function(){for(var t=this.pool,e=this.io,i=this.messages,u=this.debugMode,c=0;c<t.length;c++){if(t[c].sprite||t[c].sprites){var d=t[c].sprite||t[c].sprites[0];if("Sprite"==d.constructor.name&&d._deleted){t.splice(c,1);continue}}"hover"==t[c].event?s(t[c].sprite,t[c].handler,e.cursor,u):"click"==t[c].event?o(t[c].sprite,t[c].handler,e.clicked,u):"mousedown"==t[c].event?o(t[c].sprite,t[c].handler,e.mousedown,u):"mouseup"==t[c].event?o(t[c].sprite,t[c].handler,e.mouseup,u):"keydown"==t[c].event?n(t[c].key,t[c].handler,e.keydown,u):"keyup"==t[c].event?n(t[c].key,t[c].handler,e.keyup,u):"holding"==t[c].event?r(t[c].key,t[c].handler,e.holding,u):"listen"==t[c].event?h(t[c].sprite,t[c].handler,i,t[c].message,u):"touch"==t[c].event&&a(t[c].sprite,t[c].handler,t[c].targets,u)}e.clearEvents(),this._clearMessages()},i.prototype._clearMessages=function(){this.messages=[]},i.prototype.clear=function(){this.pool=[]},i.prototype.register=function(){var t=arguments[0],e={event:t,handler:arguments[arguments.length-1]};"touch"===t?(e.sprite=arguments[1],arguments[2].constructor===Array?e.targets=arguments[2]:e.targets=[arguments[2]]):"keydown"===t||"keyup"===t||"holding"===t?e.key=arguments[1]:["mousedown","mouseup","hover","click"].includes(t)?e.sprite=arguments[1]:"listen"===t&&(e.message=arguments[1],e.sprite=arguments[2]),this.pool.push(e)},i.prototype.emit=function(t){this.messages.push(t)},t.exports=i},function(t,e){function i(){this.fps=0,this._lastFrameUpdatedTime=(new Date).getTime()}i.prototype.updateFPS=function(){var t=(new Date).getTime();this.fps=Math.round(1e3/(t-this._lastFrameUpdatedTime)),this._lastFrameUpdatedTime=t},t.exports=i},function(t,e){function i(t){this._state="readyToStart",this._update=t}var s=60;i.prototype.start=function(){if("readyToStart"===this._state){var t;this._state="running",t=function(){"running"===this._state?(this._update(),setTimeout(function(){requestAnimationFrame(t)},1e3/s)):this._state="readyToStart"}.bind(this),setTimeout(t,0)}else"stopping"===this._state&&setTimeout(start,10)},i.prototype.stop=function(){"running"===this._state&&(this._state="stopping")},t.exports=i},function(t,e,i){function s(t,e,i,s){function n(t){var e=r[t];return e||(e=new Image,e.src=t,r[t]=e),e}var r=i,h=[];this.clear=function(){t.clearRect(0,0,e.width,e.height)},this.print=function(t,e,i,s,n,r){h.push({words:t,x:o.isNumeric(e)?e:20,y:o.isNumeric(i)?i:20,color:s||"black",size:n||16,font:r||"Arial"})},this.drawTexts=function(){for(var e=0;e<h.length;e++){var i=h[e];t.textBaseline="top",t.font=i.size+"px "+i.font,t.fillStyle=i.color,t.fillText(i.words,i.x,i.y)}h=[]},this.drawSprites=function(t){t.each(this.drawInstance)},this.drawInstance=function(e){if(!e.hidden){var i=n(e.getCurrentCostume());e.width=i.width*e.scale,e.height=i.height*e.scale;var s=o.degreeToRad(e.direction);if(t.globalAlpha=e.opacity,"flipped"===e.rotationStyle){if(s>=Math.PI)return t.translate(2*e.x,0),t.scale(-1,1),t.drawImage(i,e.x-e.width/2,e.y-e.height/2,e.width,e.height),t.scale(-1,1),t.translate(2*-e.x,0),void(t.globalAlpha=1);var s=0}if("fixed"===e.rotationStyle)var s=0;t.translate(e.x,e.y),t.rotate(s),t.drawImage(i,-e.width/2,-e.height/2,e.width,e.height),t.rotate(-s),t.translate(-e.x,-e.y),t.globalAlpha=1}},this.getImgFromCache=n,this.drawBackdrop=function(i,s,o,n,h){if(i.includes(".")){var a=r[i];a||(a=new Image,a.src=i,r[i]=a),t.drawImage(a,s||0,o||0,n||a.width,h||a.height)}else t.fillStyle=i,t.fillRect(0,0,e.width,e.height)}}var o=i(2);t.exports=s},function(t,e){function i(t,e){this.sounds=t,this.playing=[],this.muted=!1,this.volume=1}i.prototype={play:function(t,e){var i;return this.sounds[t]?(i=this.sounds[t].cloneNode(),this.playing.push(i),i.play()):(i=new Audio(t),this.sounds[t]=i,this.playing.push(i),i.play()),i.loop=e,i.muted=this.muted,i.volume=this.volume,i},stop:function(){for(var t=0;t<this.playing.length;t++)this.playing[t].pause();this.playing=[]},mute:function(t){this.muted=t;for(var e=0;e<this.playing.length;e++)this.playing[e].muted=t},setVolume:function(t){this.volume=t;for(var e=0;e<this.playing.length;e++)this.playing[e].volume=t},each:function(t){for(var e=0;e<this.playing.length;e++)t(this.playing[e])}},t.exports=i},function(t,e){function i(){this.loaded=0,this.paths=[],this.sounds={},this.images={},this.completeFunc,this.progressFunc}i.prototype={preload:function(t,e,i){this.paths=t,this.completeFunc=e,this.progressFunc=i;for(var s=0;s<t.length;s++){var o=t[s],n=o.split(".").pop();["jpg","jpeg","png","gif"].includes(n)&&this._loadImage(o),["mp3","ogg","wav"].includes(n)&&this._loadSound(o)}},_loadImage:function(t){var e=this,i=new Image;i.src=t,i.onload=function(){e._loaded()},this.images[t]=i},_loadSound:function(t){var e=this,i=new Audio;i.src=t,i.addEventListener("canplaythrough",function(){e._loaded()}),this.sounds[t]=i},_loaded:function(){this.loaded+=1,this.progressFunc&&this.progressFunc(this.loaded,this.paths.length),this.loaded===this.paths.length&&this.completeFunc&&this.completeFunc()}},t.exports=i},function(t,e,i){function s(t,e,i){var s={x:0,y:0,isDown:!1,left:!1,right:!1},n={x:null,y:null},r={x:null,y:null},h={x:null,y:null},a={},u={},c={};this.mousedown=r,this.mouseup=h,i=i||!1,t.setAttribute("tabindex","1"),t.style.outline="none",t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",function(t){1==t.which&&(s.left=!0),3==t.which&&(s.right=!0),s.isDown=!0,r.x=t.offsetX/e.zoom,r.y=t.offsetY/e.zoom}),t.addEventListener("mouseup",function(t){1==t.which&&(s.left=!1),3==t.which&&(s.right=!1),s.isDown=s.left||s.right,h.x=t.offsetX/e.zoom,h.y=t.offsetY/e.zoom}),t.addEventListener("mousemove",function(t){s.x=t.offsetX/e.zoom,s.y=t.offsetY/e.zoom}),t.addEventListener("click",function(t){n.x=t.offsetX/e.zoom,n.y=t.offsetY/e.zoom,i&&console.log("Clicked! cursor:"+JSON.stringify(s))}),t.addEventListener("keydown",function(t){var e=o(t.keyCode);u[e]=!0,c[e]=!0,i&&console.log("Keydown! key:"+e)}),t.addEventListener("keyup",function(t){var e=o(t.keyCode);a[e]=!0,c[e]=!1,i&&console.log("Keyup! key:"+e)}),this.cursor=s,this.clicked=n,this.keyup=a,this.keydown=u,this.holding=c}var o=i(11);s.prototype.clearEvents=function(){this.clicked.x=null,this.clicked.y=null,this.mousedown.x=null,this.mousedown.y=null,this.mouseup.x=null,this.mouseup.y=null;for(var t in this.keydown)this.keydown[t]=!1,this.keyup[t]=!1},t.exports=s},function(t,e){e=t.exports=function(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return n[t];var o=String(t),r=i[o.toLowerCase()];if(r)return r;var r=s[o.toLowerCase()];return r?r:1===o.length?o.charCodeAt(0):void 0};var i=e.code=e.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,"delete":46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s=e.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,"break":19,caps:20,"return":13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};/*!
	 * Programatically add the following
	 */
for(o=97;o<123;o++)i[String.fromCharCode(o)]=o-32;for(var o=48;o<58;o++)i[o-48]=o;for(o=1;o<13;o++)i["f"+o]=o+111;for(o=0;o<10;o++)i["numpad "+o]=o+96;var n=e.names=e.title={};for(o in i)n[i[o]]=o;for(var r in s)i[r]=s[r]}]);