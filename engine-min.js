!function t(e,i,n){function s(r,h){if(!i[r]){if(!e[r]){var a="function"==typeof require&&require;if(!h&&a)return a(r,!0);if(o)return o(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return s(i||t)},c,c.exports,t,e,i,n)}return i[r].exports}for(var o="function"==typeof require&&require,r=0;r<n.length;r++)s(n[r]);return s}({1:[function(t,e,i){var n=(i=e.exports=function(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return r[t];var i,o=String(t);return(i=n[o.toLowerCase()])?i:(i=s[o.toLowerCase()])||(1===o.length?o.charCodeAt(0):void 0)}).code=i.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},s=i.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(o=97;o<123;o++)n[String.fromCharCode(o)]=o-32;for(var o=48;o<58;o++)n[o-48]=o;for(o=1;o<13;o++)n["f"+o]=o+111;for(o=0;o<10;o++)n["numpad "+o]=o+96;var r=i.names=i.title={};for(o in n)r[n[o]]=o;for(var h in s)n[h]=s[h]},{}],2:[function(t,e,i){e.exports=function(t,e,i){this._state="readyToStart",this._onTick=t,this._render=e,this.start=function(){if("readyToStart"===this._state){var t,e=(new Date).getTime();this._state="running",t=function(){if("running"===this._state){var n=(new Date).getTime(),s=n-e,o=1e3/i.fpsMax;s>o&&(this._onTick(),this._render(),e=n-s%o),requestAnimationFrame(t)}else this._state="readyToStart"}.bind(this),setTimeout(t,0)}else"stopping"===this._state&&setTimeout(start,10)},this.stop=function(){"running"!==this._state&&"readyToStart"!==this._state||(this._state="stopping")}}},{}],3:[function(t,e,i){const n=["click","mousedown","mouseup","keydown","keyup","holding","touch","hover"];function s(t){this.pool=[],this.io=t}s.prototype={traverse:function(){var t=this.io,e=this;this.pool.forEach(function(i){"touch"===i.event?e.touchJudger(i.sprite,i.handler,i.targets):"click"===i.event?e.mouseJudger(i.sprite,i.handler,t.clicked):"hover"===i.event?e.hoverJudger(i.sprite,i.handler,t.cursor):"mousedown"===i.event?e.mouseJudger(i.sprite,i.handler,t.mousedown):"mouseup"===i.event?e.mouseJudger(i.sprite,i.handler,t.mouseup):"holding"===i.event?e.keyJudger(i.key,i.handler,t.holding):"keyup"===i.event?e.keyJudger(i.key,i.handler,t.keyup):"keydown"===i.event&&e.keyJudger(i.key,i.handler,t.keydown)}),this.pool=this.pool.filter(function(t){return!(t.sprite&&t.sprite._deleted)}),t.clearEvents()},register:function(){if(this.validEventName(arguments[0])){var t=arguments[0],e={event:t,handler:arguments[arguments.length-1]};"touch"===t?(e.sprite=arguments[1],e.targets=[].concat(arguments[2])):"hover"===t?e.sprite=[].concat(arguments[1]):["keydown","keyup","holding"].includes(t)?e.key=arguments[1]instanceof Function?"any":arguments[1]:["mousedown","mouseup","click"].includes(t)?arguments[1]instanceof Function?e.sprite=null:arguments[1]instanceof Array?e.sprite=arguments[1]:e.sprite=[arguments[1]]:"listen"===t&&(e.message=arguments[1],e.sprite=arguments[2]),this.pool.push(e)}},emit:function(t){for(var e=0;e<this.pool.length;e++){var i=this.pool[e];"listen"==i.event&&i.message==t&&i.handler.call(i.sprite)}},mouseJudger:function(t,e,i){i.x&&i.y&&(t?t.forEach(function(t){t.touched(i.x,i.y)&&e.call(t)}):e())},keyJudger:function(t,e,i){i[t]&&e()},touchJudger:function(t,e,i){i.forEach(function(i){t.touched(i)&&e.call(t,i)})},hoverJudger:function(t,e,i){t.forEach(function(t){t.touched(i.x,i.y)&&e.call(t)})},validEventName:function(t){return!1===n.includes(t)&&console.error("`"+t+"` 事件是不支援的，請檢查是否符合以下支援的事件\n "+this.VALID_EVENT_NAMES.join(", ")),!0},VALID_EVENT_NAMES:n},e.exports=s},{}],4:[function(t,e,i){var n=t("./sprite"),s=t("./sprites"),o=t("./event-list"),r=t("./inspector"),h=t("./clock"),a=t("./renderer"),c=t("./sound"),u=t("./loader"),d=t("./io"),l=t("./pen"),p=t("./touch-system");window.Engine=function(t,e){e=e||!1;var i=document.getElementById(t),f=document.createElement("canvas"),g={width:i.width,height:i.height,zoom:1,updateFunctions:[],fpsMax:60,precision:1};f.width=i.width/g.precision,f.height=i.height/g.precision;var y=!0,w=new u,x=new s,m=new r,A=new d(i,g,e),v=new o(A,e),k=new a(i,w,g),S=new c(w,e),T=new l(i),B=new p(f,w,g),_=new h(function(){v.traverse();for(var t=0;t<g.updateFunctions.length;t++)g.updateFunctions[t]();x.removeDeletedSprites(),x.runOnTick(),m.updateFPS()},function(){y&&(k.drawBackdrop(M.path,M.x,M.y,M.w,M.h),T.drawShapes(),k.drawSprites(x),T.drawTexts())},g),M={path:"#ffffff"};function F(t,e,i,n,s){M.path=t,M.x=e,M.y=i,M.w=n,M.h=s}function b(t){g.updateFunctions.push(t)}function D(t,e,i,n,s,o){T.drawText(t,e,i,n,s,o)}var C={createSprite:function(t){return new n(t,v,k,w,B,g,x)},Sprite:n,print:D,drawText:D,setBackground:F,setBackdrop:F,cursor:A.cursor,key:A.holding,inspector:m,when:v.register.bind(v),on:v.register.bind(v),set:function(t){return t.precision&&(g.precision=t.precision),t.width&&(i.width=g.width=t.width),t.height&&(i.height=g.height=t.height),t.zoom&&(g.zoom=t.zoom,i.style.width=i.width*g.zoom+"px",i.style.height=i.height*g.zoom+"px"),(t.precision||t.width||t.height)&&(f.width=i.width/g.precision,f.height=i.height/g.precision),g.update=t.update||g.update,g.fpsMax=t.fpsMax||g.fpsMax,this},stop:function(){_.stop(),S.stop()},stopRendering:function(){y=!1,T.drawingMode="instant"},start:_.start.bind(_),forever:b,update:b,always:b,clear:k.clear.bind(k),preload:function(t,e,i){w.preload(t,e,i)},sound:S,broadcast:v.emit.bind(v),pen:T,drawBackdrop:k.drawBackdrop,drawBackground:k.drawBackdrop,drawSprites:k.drawSprites};return e&&(C.eventList=v),C}},{"./clock":2,"./event-list":3,"./inspector":5,"./io":6,"./loader":7,"./pen":8,"./renderer":9,"./sound":11,"./sprite":12,"./sprites":13,"./touch-system":14}],5:[function(t,e,i){function n(){this.fps=0,this._lastFrameUpdatedTime=(new Date).getTime()}n.prototype.updateFPS=function(){var t=(new Date).getTime();this.fps=Math.round(1e3/(t-this._lastFrameUpdatedTime)),this._lastFrameUpdatedTime=t},e.exports=n},{}],6:[function(t,e,i){var n=t("keycode");function s(t,e,i){var s=this.cursor={x:0,y:0,isDown:!1,left:!1,right:!1},o=this.clicked={x:null,y:null},r=this.mousedown={x:null,y:null},h=this.mouseup={x:null,y:null},a=this.keyup={any:!1},c=this.keydown={any:!1},u=this.holding={any:!1,count:0};for(var d in n.codes)u[d]=!1;function l(i){return{x:(i.pageX-t.offsetLeft)/e.zoom,y:(i.pageY-t.offsetTop)/e.zoom}}i=i||!1,t.setAttribute("tabindex","1"),t.style.outline="none",t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",function(t){1==t.which&&(s.left=!0),3==t.which&&(s.right=!0),s.isDown=!0,r.x=t.offsetX/e.zoom,r.y=t.offsetY/e.zoom}),t.addEventListener("mouseup",function(t){1==t.which&&(s.left=!1),3==t.which&&(s.right=!1),s.isDown=s.left||s.right,h.x=t.offsetX/e.zoom,h.y=t.offsetY/e.zoom}),t.addEventListener("mousemove",function(t){s.x=t.offsetX/e.zoom,s.y=t.offsetY/e.zoom}),t.addEventListener("touchstart",function(t){s.isDown=!0;var e=l(t.changedTouches[0]);s.x=r.x=e.x,s.y=r.y=e.y}),t.addEventListener("touchend",function(t){s.isDown=!1;var e=l(t.changedTouches[0]);s.x=h.x=e.x,s.y=h.y=e.y}),t.addEventListener("touchmove",function(t){var e=l(t.changedTouches[0]);s.x=e.x,s.y=e.y}),t.addEventListener("click",function(t){o.x=t.offsetX/e.zoom,o.y=t.offsetY/e.zoom,i&&console.log("Clicked! cursor:"+JSON.stringify(s))}),t.addEventListener("keydown",function(t){var e=n(t.keyCode);u[e]||(u.any=(u.count+=1)>0),c.any=!0,c[e]=!0,u[e]=!0,i&&console.log("Keydown! key:"+e)}),t.addEventListener("keyup",function(t){var e=n(t.keyCode);u.any=(u.count-=1)>0,a.any=!0,a[e]=!0,u[e]=!1,i&&console.log("Keyup! key:"+e)})}s.prototype.clearEvents=function(){for(var t in this.clicked.x=null,this.clicked.y=null,this.mousedown.x=null,this.mousedown.y=null,this.mouseup.x=null,this.mouseup.y=null,this.keydown)this.keydown[t]=!1,this.keyup[t]=!1},e.exports=s},{keycode:1}],7:[function(t,e,i){const n="data:image/jpeg;base64,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";function s(){this.context=new(window.AudioContext||window.webkitAudioContext),this.loaded=0,this.paths=[],this.sounds={},this.images={},this.completeFunc,this.progressFunc}s.prototype={preload:function(t,e,i){if(0===t.length)return e();this.paths=t,this.completeFunc=e,this.progressFunc=i;for(var n=0;n<t.length;n++){var s=t[n],o=s.split(".").pop();["jpg","jpeg","png","gif","svg"].includes(o)&&this._loadImage(s),["mp3","ogg","wav","midi"].includes(o)&&this._loadSound(s)}},getImgFromCache:function(t){var e=this.images[t];return e||((e=new Image).src=t,e.onerror=function(t){console.error(this.src.split("/").pop()+" 素材載入失敗，請確認是否填寫正確！ \n 圖片路徑："+this.src),e.src=n},this.images[t]=e),e},_loadImage:function(t){var e=this,i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=function(){e._loaded()},i.onerror=function(t){console.error(this.src.split("/").pop()+" 素材載入失敗，請確認是否填寫正確！ \n 圖片路徑："+this.src),img.src=n},this.images[t]=i},_loadSound:function(t){var e=this;this._xhrLoad(t,function(i){var n=i.response;e.context.decodeAudioData(n,function(i){e.sounds[t]=i,e._loaded()})})},_loaded:function(){this.loaded+=1,this.progressFunc&&this.progressFunc(this.loaded,this.paths.length),this.loaded>=this.paths.length&&this.completeFunc&&this.completeFunc()},_xhrLoad:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e(i)},i.onerror=function(){console.error(i)},i.send()}},e.exports=s},{}],8:[function(e,i,n){function s(t){this.ctx=t.getContext("2d"),this.size=1,this.color="black",this.fillColor=null,this.drawingMode="onTick",this.shapes=[],this.texts=[]}s.prototype={drawShapes:function(){for(var t,e=this.ctx,i=0;i<this.shapes.length;i++)t=this.shapes[i],e.lineWidth=t.size,e.strokeStyle=t.color,e.fillStyle=t.fillColor,"line"==t.type?this._drawLine(t.x1,t.y1,t.x2,t.y2):"circle"==t.type?this._drawCircle(t.x,t.y,t.r):"triangle"==t.type?this._drawTriangle(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3):"rect"==t.type?this._drawRect(t.x,t.y,t.w,t.h):"polygon"==t.type&&this._drawPolygon.apply(this,t.points);this.shapes=[]},drawTexts:function(){for(var e=0;e<this.texts.length;e++)t=this.texts[e],this._drawText(t.text,t.x,t.y,t.color,t.size,t.font);this.texts=[]},drawText:function(t,e,i,n,s,o){if(e=void 0==e?10:e,i=void 0==i?10:i,n=n||"black",s=s||16,o=o||"Arial","instant"==this.drawingMode)return this._drawText(t,e,i,n,s,o);this._addText({text:t,x:e,y:i,color:n,size:s,font:o})},drawLine:function(t,e,i,n){if("instant"==this.drawingMode)return this._drawLine(t,e,i,n);var s={};s.x1=t,s.y1=e,s.x2=i,s.y2=n,s.type="line",this._addShape(s)},drawCircle:function(t,e,i){if("instant"==this.drawingMode)return this._drawCircle(t,e,i);var n={};n.x=t,n.y=e,n.r=i,n.type="circle",this._addShape(n)},drawTriangle:function(t,e,i,n,s,o){if("instant"==this.drawingMode)return this._drawTriangle(t,e,i,n,s,o);var r={};r.x1=t,r.y1=e,r.x2=i,r.y2=n,r.x3=s,r.y3=o,r.type="triangle",this._addShape(r)},drawRect:function(t,e,i,n){if("instant"==this.drawingMode)return this._drawRect(t,e,i,n);var s={};s.x=t,s.y=e,s.w=i,s.h=n,s.type="rect",this._addShape(s)},drawPolygon:function(){if("instant"==this.drawingMode)return this._drawPolygon.apply(this,arguments);var t={};t.points=Array.prototype.slice.call(arguments),t.type="polygon",this._addShape(t)},_drawText:function(t,e,i,n,s,o){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.textBaseline="top",this.ctx.font=s+"px "+o,this.ctx.fillStyle=n,this.ctx.fillText(t,e,i)},_drawLine:function(t,e,i,n){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawCircle:function(t,e,i){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawTriangle:function(t,e,i,n,s,o){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,n),this.ctx.lineTo(s,o),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawRect:function(t,e,i,n){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(t+i,e),this.ctx.lineTo(t+i,e+n),this.ctx.lineTo(t,e+n),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawPolygon:function(){"instant"==this.drawingMode&&this._setPenAttr();var t=Array.prototype.slice.call(arguments);this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)this.ctx.lineTo(t[e],t[e+1]);this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_setPenAttr:function(){this.ctx.lineWidth=this.size,this.ctx.strokeStyle=this.color,this.ctx.fillStyle=this.fillColor},_addShape:function(t){t.size=this.size,t.color=this.color,t.fillColor=this.fillColor,this.shapes.push(t)},_addText:function(t){this.texts.push(t)}},i.exports=s},{}],9:[function(t,e,i){var n=t("./util");function s(t,e,i){this.canvas=t,this.ctx=t.getContext("2d"),this.loader=e,this.settings=i}s.prototype={clear:function(){this.ctx.clearRect(0,0,this.settings.width,this.settings.height)},drawSprites:function(t){t._sprites.sort(function(t,e){return t.layer-e.layer});var e=this;t.each(function(t){e.drawInstance(t)})},drawInstance:function(t){if(!t.hidden){var e=this.ctx,i=t.getCostumeImage(),s=n.degreeToRad(t.direction-90);if(e.globalAlpha=t.opacity,"flipped"===t.rotationStyle){if(t.direction>180)return e.translate(2*t.x,0),e.scale(-1,1),e.drawImage(i,t.x-t.width/2,t.y-t.height/2,t.width,t.height),e.scale(-1,1),e.translate(2*-t.x,0),void(e.globalAlpha=1);s=0}if("fixed"===t.rotationStyle)s=0;e.translate(t.x,t.y),e.rotate(s),e.drawImage(i,-t.width/2,-t.height/2,t.width,t.height),e.rotate(-s),e.translate(-t.x,-t.y),e.globalAlpha=1}},drawBackdrop:function(t,e,i,n,s){if(t.includes(".")){var o=this.loader.getImgFromCache(t);this.ctx.drawImage(o,e||0,i||0,n||o.width,s||o.height)}else t&&(this.ctx.fillStyle=t,this.ctx.fillRect(0,0,this.settings.width,this.settings.height))}},e.exports=s},{"./util":15}],10:[function(t,e,i){function n(t){this.source=null,this.gainNode=t.createGain(),this.context=t,this.isLoop=!1,this.bufferData=null,this.volume=1,this.gainNode.connect(t.destination)}n.prototype={setVolume:function(t){if(t<0)return console.error("無效的音量值");this.volume=t,this.gainNode.gain.value=t},setBufferData:function(t){this.bufferData=t},setLoop:function(t){this.isLoop=t},mute:function(t){this.gainNode.gain.value=t?0:this.volume},pause:function(){this.source.playbackRate.value=Number.MIN_VALUE},resume:function(){this.source.playbackRate.value=1},play:function(){this.source=this.context.createBufferSource(),this.source.buffer=this.bufferData,this.source.loop=this.isLoop,this.source.connect(this.gainNode),this.source.start(0)},stop:function(){this.source.stop()}},e.exports=n},{}],11:[function(t,e,i){var n=t("./sound-node");function s(t,e){this.context=new(window.AudioContext||window.webkitAudioContext),this.soundNodes=[],this.loader=t,this.sounds=t.sounds,this.muted=!1}s.prototype={play:function(t,e){e=void 0!==e&&e;var i=new n(this.context);if(this.sounds[t]){var s=this.sounds[t];i.setBufferData(s),i.setLoop(e),this.soundNodes.push(i),i.play()}else{var o=this;this.loader._xhrLoad(t,function(n){var s=n.response;o.context.decodeAudioData(s,function(n){o.sounds[t]=n,i.setBufferData(n),i.setLoop(e),o.soundNodes.push(i),i.play()})})}return i},setVolume:function(t){if(t<0)return console.error("無效的音量值");for(var e=0;e<this.soundNodes.length;e++){this.soundNodes[e].setVolume(t)}},mute:function(t){for(var e=0;e<this.soundNodes.length;e++){this.soundNodes[e].mute(t)}},pause:function(){this.context.suspend()},resume:function(){this.context.resume()},stop:function(){for(var t=0;t<this.soundNodes.length;t++){this.soundNodes[t].stop()}}},e.exports=s},{"./sound-node":10}],12:[function(t,e,i){var n=t("./util");function s(t,e,i,s,o,r,h){t.constructor!==String&&t.constructor!==Array||(t={costumes:[].concat(t)}),this.x=n.isNumeric(t.x)?t.x:r.width/2,this.y=n.isNumeric(t.y)?t.y:r.height/2,this.direction=n.isNumeric(t.direction)?t.direction:90,this.scale=n.isNumeric(t.scale)?t.scale:1,this.layer=n.isNumeric(t.layer)?t.layer:0,this.opacity=n.isNumeric(t.opacity)?t.opacity:1,this.costumeId=n.isNumeric(t.costumeId)?t.costumeId:0,this.costumes=[].concat(t.costumes),this.hidden=!!t.hidden,this.rotationStyle=["full","flipped","fixed"].includes(t.rotationStyle)?t.rotationStyle:"full",this.width=1,this.height=1,this._onTickFuncs=[],this._deleted=!1,this._animation={frames:[],rate:5,timer:0},this._eventList=e,this._renderer=i,this._loader=s,this._touchSystem=o,this._settings=r,h._sprites.push(this)}s.prototype={stepForward:function(t){var e=n.degreeToRad(this.direction);this.x+=Math.sin(e)*t,this.y-=Math.cos(e)*t},moveTo:function(){var t=n.position(arguments);this.x=t.x,this.y=t.y},move:function(t,e){this.x+=t,this.y+=e},toward:function(){var t=n.position(arguments);this.direction=n.vectorToDegree(t.x-this.x,t.y-this.y)},touched:function(){if(arguments[0].constructor===Array){for(var t=0;t<arguments[0].length;t++)if(this._isTouched(arguments[0][t]))return!0;return!1}return this._isTouched.apply(this,arguments)},distanceTo:function(){var t=n.position(arguments);return n.distanceBetween(this.x,this.y,t.x,t.y)},forever:function(t){this._onTickFuncs.push(t)},on:function(){var t=arguments[0],e=this._eventList;if(e.validEventName(t))return"touch"===t?e.register(t,this,arguments[1],arguments[2]):["mousedown","mouseup","click","hover"].includes(t)?e.register(t,this,arguments[1]):["keydown","keydup","holding"].includes(t)?e.register(t,arguments[1],arguments[2]):"listen"===t?e.register(t,arguments[1],this,arguments[2]):void 0},destroy:function(){this._deleted=!0},nextCostume:function(){this.costumeId+=1,this.costumeId>=this.costumes.length&&(this.costumeId=0)},bounceEdge:function(){this.x<0?(this.x=0,this.direction>180&&this.direction>0&&(this.direction=-this.direction)):this.x>this._settings.width&&(this.x=this._settings.width,this.direction<180&&(this.direction=-this.direction)),this.y<0?(this.y=0,(this.direction<90||this.direction>270)&&(this.direction=180-this.direction)):this.y>this._settings.height&&(this.y=this._settings.height,(this.direction>90||this.direction<270)&&(this.direction=180-this.direction))},animate:function(t,e,i){this._animation={frames:t,rate:e||5,callback:i,timer:0}},getCostumeImage:function(){var t=this.costumes[this.costumeId];return this._loader.getImgFromCache(t)},update:function(){this._updateDirection(),this._updateSize(),this._updateFrames();for(var t=0;t<this._onTickFuncs.length;t++)this._onTickFuncs[t].call(this)},_updateDirection:function(){this.direction=this.direction%360,this.direction<0&&(this.direction+=360)},_updateSize:function(){var t=this.getCostumeImage();this.width=t.width*this.scale,this.height=t.height*this.scale},_updateFrames:function(){var t=this._animation;if(t.frames.length>0){var e=(new Date).getTime();e>=t.timer+1e3/t.rate&&(t.timer=e,this.costumeId=t.frames.shift(),t.frames.length<=0&&t.callback&&t.callback())}},_isTouched:function(){if(arguments[0]instanceof s)return this._touchSystem.isTouch(this,arguments[0]);var t=n.position(arguments);return this._touchSystem.isTouchDot(this,t.x,t.y)}},s.prototype.when=s.prototype.on,s.prototype.always=s.prototype.forever,e.exports=s},{"./util":15}],13:[function(t,e,i){function n(){this._sprites=[]}n.prototype.runOnTick=function(){this.each(function(){this.update()})},n.prototype.each=function(t){for(var e=this._sprites,i=0;i<e.length;i++)t.call(e[i],e[i])},n.prototype.removeDeletedSprites=function(){for(var t=this._sprites,e=0;e<t.length;e++)t[e]._deleted&&t.splice(e,1)},n.prototype.clear=function(){this._sprites=[]},e.exports=n},{}],14:[function(t,e,i){var n=t("./util"),s=t("./sprite"),o=t("./renderer");function r(t,e,i){this.ctx=t.getContext("2d"),this.renderer=new o(t,e,i),this.settings=i}r.prototype={isTouchDot:function(t,e,i){return this.isTouch(t,{x:e,y:i,width:2*this.settings.precision,height:2*this.settings.precision,direction:0,area:1})},isTouch:function(t,e){if(t.hidden||t._deleted||e.hidden||e._deleted||t===e)return!1;var i=this.getBoxOf(t),n=this.getBoxOf(e);if(!1===this.AABBJudger(i,n))return!1;var s=this.reduceAccuracy(t),o=this.reduceAccuracy(e),r=i.area<n.area?i:n;return this.reduceAccuracy(r),result=this.pixelJudger(t,e,r),s(),o(),result},getBoxOf:function(t){var e={x:t.x,y:t.y,area:t.width*t.height};if(90===t.direction||270===t.direction||"full"!==t.rotationStyle)return e.width=t.width,e.height=t.height,e;if(0===t.direction||180===t.direction)return e.width=t.height,e.height=t.width,e;var i=Math.sqrt(t.width*t.width+t.height*t.height),s=Math.asin(t.width/i),o=n.degreeToRad(t.direction)-s,r=n.degreeToRad(t.direction)+s,h=Math.abs(Math.sin(o)),a=Math.abs(Math.cos(o)),c=Math.abs(Math.sin(r)),u=Math.abs(Math.cos(r));return e.width=Math.max(a,u)*i,e.height=Math.max(h,c)*i,e.area=e.width*e.height,e},AABBJudger:function(t,e){return Math.abs(t.x-e.x)<(t.width+e.width)/2&&Math.abs(t.y-e.y)<(t.height+e.height)/2},pixelJudger:function(t,e,i){if(i.width<1||i.height<1)return!1;this.ctx.clearRect(0,0,this.settings.width,this.settings.height),this.ctx.globalCompositeOperation="source-over",this.renderer.drawInstance(t),this.ctx.globalCompositeOperation="source-in",e instanceof s?this.renderer.drawInstance(e):this.ctx.fillRect(e.x,e.y,1,1);for(var n=this.ctx.getImageData(i.x-i.width/2,i.y-i.height/2,i.width,i.height).data,o=0;o<n.length;o+=4)if(n[o+3]>0)return!0;return!1},reduceAccuracy:function(t){var e=this.settings.precision,i=t.x,n=t.y,s=t.width,o=t.height,r=t.scale;return t.x/=e,t.y/=e,t.width/=e,t.height/=e,t.scale/=e,function(){t.x=i,t.y=n,t.width=s,t.height=o,t.scale=r}}},e.exports=r},{"./renderer":9,"./sprite":12,"./util":15}],15:[function(t,e,i){var n={isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},radToDegree:function(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),180*t/Math.PI},degreeToRad:function(t){return(t%=360)<0&&(t+=360),t/180*Math.PI},distanceBetween:function(t,e,i,n){return Math.sqrt(Math.pow(t-i,2)+Math.pow(e-n,2))},vectorToDegree:function(t,e){var i=Math.atan2(t,-e);return this.radToDegree(i)},position:function(t){if(this.isNumeric(t[0].x)&&this.isNumeric(t[0].y))return t[0];if(this.isNumeric(t[0])&&this.isNumeric(t[1]))return{x:t[0],y:t[1]};throw"請傳入角色(Sprite, Cursor)或是 X, Y 座標值"}};e.exports=n},{}]},{},[4]);