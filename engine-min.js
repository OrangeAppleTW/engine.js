!function t(e,i,s){function o(r,h){if(!i[r]){if(!e[r]){var a="function"==typeof require&&require;if(!h&&a)return a(r,!0);if(n)return n(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return o(i||t)},c,c.exports,t,e,i,s)}return i[r].exports}for(var n="function"==typeof require&&require,r=0;r<s.length;r++)o(s[r]);return o}({1:[function(t,e,i){var s=(i=e.exports=function(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return r[t];var i,n=String(t);return(i=s[n.toLowerCase()])?i:(i=o[n.toLowerCase()])||(1===n.length?n.charCodeAt(0):void 0)}).code=i.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},o=i.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(n=97;n<123;n++)s[String.fromCharCode(n)]=n-32;for(var n=48;n<58;n++)s[n-48]=n;for(n=1;n<13;n++)s["f"+n]=n+111;for(n=0;n<10;n++)s["numpad "+n]=n+96;var r=i.names=i.title={};for(n in s)r[s[n]]=n;for(var h in o)s[h]=o[h]},{}],2:[function(t,e,i){e.exports=function(t,e,i){this._state="readyToStart",this._onTick=t,this._render=e,this.start=function(){if("readyToStart"===this._state){var t,e=(new Date).getTime();this._state="running",t=function(){if("running"===this._state){var s=(new Date).getTime(),o=s-e,n=1e3/i.fpsMax;o>n&&(this._onTick(),this._render(),e=s-o%n),requestAnimationFrame(t)}else this._state="readyToStart"}.bind(this),setTimeout(t,0)}else"stopping"===this._state&&setTimeout(start,10)},this.stop=function(){"running"!==this._state&&"readyToStart"!==this._state||(this._state="stopping")}}},{}],3:[function(t,e,i){function s(t,e){this.pool=[],this.io=t,this.debugMode=e||!1}function o(t,e,i,s){i.x&&i.y&&(t?t.touched(i.x,i.y)&&(e.call(t),s&&console.log("Just fired a click handler on a sprite! ("+JSON.stringify(i)+")")):(e(),s&&console.log("Just fired a click handler on stage! ("+JSON.stringify(i)+")")))}function n(t,e,i,s){i[t]&&(e(),s&&console.log("Just fired a keydown handler on: "+key))}function r(t,e,i,s){for(var o,n=0;o=i[n];n++)t.touched(o)&&(e.call(t,o),s&&console.log({event:"Touch",sprite:t,target:o}))}s.prototype.traverse=function(){for(var t=this.pool,e=this.io,i=this.debugMode,s=0;s<t.length;s++)t[s].sprite&&t[s]._deleted?t.splice(s--,1):"click"==t[s].event?o(t[s].sprite,t[s].handler,e.clicked,i):"mousedown"==t[s].event?o(t[s].sprite,t[s].handler,e.mousedown,i):"mouseup"==t[s].event?o(t[s].sprite,t[s].handler,e.mouseup,i):"keydown"==t[s].event?n(t[s].key,t[s].handler,e.keydown,i):"keyup"==t[s].event?n(t[s].key,t[s].handler,e.keyup,i):"holding"==t[s].event?n(t[s].key,t[s].handler,e.holding,i):"touch"==t[s].event&&r(t[s].sprite,t[s].handler,t[s].targets,i);e.clearEvents()},s.prototype.clear=function(){this.pool=[]},s.prototype.register=function(){var t=arguments[0],e={event:t,handler:arguments[arguments.length-1]};"touch"===t?(e.sprite=arguments[1],arguments[2].constructor===Array?e.targets=arguments[2]:e.targets=[arguments[2]]):["keydown","keyup","holding"].includes(t)?e.key=arguments[1]||"any":["mousedown","mouseup","click"].includes(t)?e.sprite=arguments[1]:"listen"===t&&(e.message=arguments[1],e.sprite=arguments[2]),this.pool.push(e)},s.prototype.emit=function(t){for(var e=0;e<this.pool.length;e++){var i=this.pool[e];"listen"==i.event&&i.message==t&&i.handler.call(i.sprite)}},e.exports=s},{}],4:[function(t,e,i){var s=t("./sprite"),o=t("./sprites"),n=t("./event-list"),r=t("./inspector"),h=t("./clock"),a=t("./renderer"),c=t("./sound"),u=t("./loader"),d=t("./io"),l=t("./pen");window.Engine=function(t,e){e=e||!1;var i=document.getElementById(t),p=i.getContext("2d"),f=document.createElement("canvas"),y=f.getContext("2d");f.width=i.width,f.height=i.height;var g={width:i.width,height:i.height,zoom:1,updateFunctions:[],fpsMax:60},m=!0,x=new u,w=new o,v=new r,_=new d(i,g,e),T=new n(_,e),k=new a(p,g,x.images,e),N=new c(x,e),C=new l(p),S=new h(function(){T.traverse();for(var t=0;t<g.updateFunctions.length;t++)g.updateFunctions[t]();w.removeDeletedSprites(),w.runOnTick(),v.updateFPS()},function(){m&&(k.drawBackdrop(b.path,b.x,b.y,b.w,b.h),C.drawShapes(),k.drawSprites(w),C.drawTexts())},g);s.prototype._sprites=w,s.prototype._eventList=T,s.prototype._settings=g,s.prototype._renderer=k,s.prototype._hitTester=y;var b={path:"#ffffff"};function M(t,e,i,s,o){b.path=t,b.x=e,b.y=i,b.w=s,b.h=o}function I(t,e,i){["keydown","keyup","mousedown","mouseup","holding","click"].includes(t)&&("function"==typeof e?T.register(t,null,e):T.register(t,e,i))}function F(t){g.updateFunctions.push(t)}var L={createSprite:function(t){return new s(t)},Sprite:s,print:function(t,e,i,s,o,n){C.print(t,e,i,s,o,n)},setBackground:M,setBackdrop:M,cursor:_.cursor,key:_.holding,inspector:v,when:I,on:I,set:function(t){return t.width&&(f.width=i.width=g.width=t.width),t.height&&(f.height=i.height=g.height=t.height),t.zoom&&(g.zoom=t.zoom,i.style.width=i.width*g.zoom+"px",i.style.height=i.height*g.zoom+"px"),g.update=t.update||g.update,g.fpsMax=t.fpsMax||g.fpsMax,this},stop:function(){S.stop(),N.stop()},stopRendering:function(){m=!1,C.drawingMode="instant"},start:function(){S.start()},forever:F,update:F,always:F,clear:function(){k.clear()},preload:function(t,e,i){x.preload(t,e,i)},sound:N,broadcast:T.emit.bind(T),pen:C,drawBackdrop:k.drawBackdrop,drawBackground:k.drawBackdrop,drawSprites:k.drawSprites};return e&&(L.eventList=T),L}},{"./clock":2,"./event-list":3,"./inspector":5,"./io":6,"./loader":7,"./pen":8,"./renderer":9,"./sound":11,"./sprite":12,"./sprites":13}],5:[function(t,e,i){function s(){this.fps=0,this._lastFrameUpdatedTime=(new Date).getTime()}s.prototype.updateFPS=function(){var t=(new Date).getTime();this.fps=Math.round(1e3/(t-this._lastFrameUpdatedTime)),this._lastFrameUpdatedTime=t},e.exports=s},{}],6:[function(t,e,i){var s=t("keycode");function o(t,e,i){var o=this.cursor={x:0,y:0,isDown:!1,left:!1,right:!1},n=this.clicked={x:null,y:null},r=this.mousedown={x:null,y:null},h=this.mouseup={x:null,y:null},a=this.keyup={any:!1},c=this.keydown={any:!1},u=this.holding={any:!1,count:0};for(var d in s.codes)u[d]=!1;function l(i){return{x:(i.pageX-t.offsetLeft)/e.zoom,y:(i.pageY-t.offsetTop)/e.zoom}}i=i||!1,t.setAttribute("tabindex","1"),t.style.outline="none",t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",function(t){1==t.which&&(o.left=!0),3==t.which&&(o.right=!0),o.isDown=!0,r.x=t.offsetX/e.zoom,r.y=t.offsetY/e.zoom}),t.addEventListener("mouseup",function(t){1==t.which&&(o.left=!1),3==t.which&&(o.right=!1),o.isDown=o.left||o.right,h.x=t.offsetX/e.zoom,h.y=t.offsetY/e.zoom}),t.addEventListener("mousemove",function(t){o.x=t.offsetX/e.zoom,o.y=t.offsetY/e.zoom}),t.addEventListener("touchstart",function(t){o.isDown=!0;var e=l(t.changedTouches[0]);o.x=r.x=e.x,o.y=r.y=e.y}),t.addEventListener("touchend",function(t){o.isDown=!1;var e=l(t.changedTouches[0]);o.x=h.x=e.x,o.y=h.y=e.y}),t.addEventListener("touchmove",function(t){var e=l(t.changedTouches[0]);o.x=e.x,o.y=e.y}),t.addEventListener("click",function(t){n.x=t.offsetX/e.zoom,n.y=t.offsetY/e.zoom,i&&console.log("Clicked! cursor:"+JSON.stringify(o))}),t.addEventListener("keydown",function(t){var e=s(t.keyCode);u[e]||(u.any=(u.count+=1)>0),c.any=!0,c[e]=!0,u[e]=!0,i&&console.log("Keydown! key:"+e)}),t.addEventListener("keyup",function(t){var e=s(t.keyCode);u.any=(u.count-=1)>0,a.any=!0,a[e]=!0,u[e]=!1,i&&console.log("Keyup! key:"+e)})}o.prototype.clearEvents=function(){for(var t in this.clicked.x=null,this.clicked.y=null,this.mousedown.x=null,this.mousedown.y=null,this.mouseup.x=null,this.mouseup.y=null,this.keydown)this.keydown[t]=!1,this.keyup[t]=!1},e.exports=o},{keycode:1}],7:[function(t,e,i){function s(){this.context=new(window.AudioContext||window.webkitAudioContext),this.loaded=0,this.paths=[],this.sounds={},this.images={},this.completeFunc,this.progressFunc}s.prototype={preload:function(t,e,i){if(0===t.length)return e();this.paths=t,this.completeFunc=e,this.progressFunc=i;for(var s=0;s<t.length;s++){var o=t[s],n=o.split(".").pop();["jpg","jpeg","png","gif","svg"].includes(n)&&this._loadImage(o),["mp3","ogg","wav","midi"].includes(n)&&this._loadSound(o)}},_loadImage:function(t){var e=this,i=new Image;i.src=t,i.crossOrigin="anonymous",i.onload=function(){e._loaded()},this.images[t]=i},_loadSound:function(t){var e=this;this._xhrLoad(t,function(i){var s=i.response;e.context.decodeAudioData(s,function(i){e.sounds[t]=i,e._loaded()})})},_loaded:function(){this.loaded+=1,this.progressFunc&&this.progressFunc(this.loaded,this.paths.length),this.loaded>=this.paths.length&&this.completeFunc&&this.completeFunc()},_xhrLoad:function(t,e){var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType="arraybuffer",i.onload=function(){e(i)},i.onerror=function(){console.error(i)},i.send()}},e.exports=s},{}],8:[function(e,i,s){function o(t){this.ctx=t,this.size=1,this.color="black",this.fillColor=null,this.drawingMode="onTick",this.shapes=[],this.texts=[]}o.prototype={drawShapes:function(){for(var t,e=this.ctx,i=0;i<this.shapes.length;i++)t=this.shapes[i],e.lineWidth=t.size,e.strokeStyle=t.color,e.fillStyle=t.fillColor,"line"==t.type?this._drawLine(t.x1,t.y1,t.x2,t.y2):"circle"==t.type?this._drawCircle(t.x,t.y,t.r):"triangle"==t.type?this._drawTriangle(t.x1,t.y1,t.x2,t.y2,t.x3,t.y3):"rect"==t.type?this._drawRect(t.x,t.y,t.w,t.h):"polygon"==t.type&&this._drawPolygon.apply(this,t.points);this.shapes=[]},drawTexts:function(){for(var e=0;e<this.texts.length;e++)t=this.texts[e],this._drawText(t.text,t.x,t.y,t.color,t.size,t.font);this.texts=[]},print:function(t,e,i,s,o,n){if(e=void 0==e?10:e,i=void 0==i?10:i,s=s||"black",o=o||16,n=n||"Arial","instant"==this.drawingMode)return this._drawText(t,e,i,s,o,n);this._addText({text:t,x:e,y:i,color:s,size:o,font:n})},drawLine:function(t,e,i,s){if("instant"==this.drawingMode)return this._drawLine(t,e,i,s);var o={};o.x1=t,o.y1=e,o.x2=i,o.y2=s,o.type="line",this._addShape(o)},drawCircle:function(t,e,i){if("instant"==this.drawingMode)return this._drawCircle(t,e,i);var s={};s.x=t,s.y=e,s.r=i,s.type="circle",this._addShape(s)},drawTriangle:function(t,e,i,s,o,n){if("instant"==this.drawingMode)return this._drawTriangle(t,e,i,s,o,n);var r={};r.x1=t,r.y1=e,r.x2=i,r.y2=s,r.x3=o,r.y3=n,r.type="triangle",this._addShape(r)},drawRect:function(t,e,i,s){if("instant"==this.drawingMode)return this._drawRect(t,e,i,s);var o={};o.x=t,o.y=e,o.w=i,o.h=s,o.type="rect",this._addShape(o)},drawPolygon:function(){if("instant"==this.drawingMode)return this._drawPolygon.apply(this,arguments);var t={};t.points=Array.prototype.slice.call(arguments),t.type="polygon",this._addShape(t)},_drawText:function(t,e,i,s,o,n){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.textBaseline="top",this.ctx.font=o+"px "+n,this.ctx.fillStyle=s,this.ctx.fillText(t,e,i)},_drawLine:function(t,e,i,s){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawCircle:function(t,e,i){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.arc(t,e,i,0,2*Math.PI),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawTriangle:function(t,e,i,s,o,n){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(i,s),this.ctx.lineTo(o,n),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawRect:function(t,e,i,s){"instant"==this.drawingMode&&this._setPenAttr(),this.ctx.beginPath(),this.ctx.moveTo(t,e),this.ctx.lineTo(t+i,e),this.ctx.lineTo(t+i,e+s),this.ctx.lineTo(t,e+s),this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_drawPolygon:function(){"instant"==this.drawingMode&&this._setPenAttr();var t=Array.prototype.slice.call(arguments);this.ctx.beginPath(),this.ctx.moveTo(t[0],t[1]);for(var e=2;e<t.length;e+=2)this.ctx.lineTo(t[e],t[e+1]);this.ctx.closePath(),this.size&&this.ctx.stroke(),this.fillColor&&this.ctx.fill()},_setPenAttr:function(){this.ctx.lineWidth=this.size,this.ctx.strokeStyle=this.color,this.ctx.fillStyle=this.fillColor},_addShape:function(t){t.size=this.size,t.color=this.color,t.fillColor=this.fillColor,this.shapes.push(t)},_addText:function(t){this.texts.push(t)}},i.exports=o},{}],9:[function(t,e,i){var s=t("./util");e.exports=function(t,e,i,o){var n=i,r=this;function h(t){var e=n[t];return e||((e=new Image).src=t,n[t]=e),e}this.autoRender=!1,this.clear=function(){t.clearRect(0,0,e.width,e.height)},this.drawSprites=function(e){!function(t){var e=t.length,i=!0;for(let s=0;s<e&&i;s++){i=!1;for(let o=0;o<e-1-s;o++)t[o].layer>t[o+1].layer&&([t[o],t[o+1]]=[t[o+1],t[o]],i=!0)}}(e._sprites),e.each(function(e){r.drawInstance(e,t)})},this.drawInstance=function(t,e){if(!t.hidden){var i=h(t.getCurrentCostume());t.width=i.width*t.scale,t.height=i.height*t.scale;var o=s.degreeToRad(t.direction-90);if(e.globalAlpha=t.opacity,"flipped"===t.rotationStyle){if(t.direction>180)return e.translate(2*t.x,0),e.scale(-1,1),e.drawImage(i,t.x-t.width/2,t.y-t.height/2,t.width,t.height),e.scale(-1,1),e.translate(2*-t.x,0),void(e.globalAlpha=1);o=0}"fixed"===t.rotationStyle&&(o=0),e.translate(t.x,t.y),e.rotate(o),e.drawImage(i,-t.width/2,-t.height/2,t.width,t.height),e.rotate(-o),e.translate(-t.x,-t.y),e.globalAlpha=1}},this.getImgFromCache=h,this.drawBackdrop=function(i,s,o,r,h){if(i.includes(".")){var a=n[i];a||((a=new Image).src=i,n[i]=a),t.drawImage(a,s||0,o||0,r||a.width,h||a.height)}else i&&(t.fillStyle=i,t.fillRect(0,0,e.width,e.height))}}},{"./util":14}],10:[function(t,e,i){function s(t){this.source=null,this.gainNode=t.createGain(),this.context=t,this.isLoop=!1,this.bufferData=null,this.volume=1,this.gainNode.connect(t.destination)}s.prototype={setVolume:function(t){if(t<0)return console.error("無效的音量值");this.volume=t,this.gainNode.gain.value=t},setBufferData:function(t){this.bufferData=t},setLoop:function(t){this.isLoop=t},mute:function(t){this.gainNode.gain.value=t?0:this.volume},pause:function(){this.source.playbackRate.value=Number.MIN_VALUE},resume:function(){this.source.playbackRate.value=1},play:function(){this.source=this.context.createBufferSource(),this.source.buffer=this.bufferData,this.source.loop=this.isLoop,this.source.connect(this.gainNode),this.source.start(0)},stop:function(){this.source.stop()}},e.exports=s},{}],11:[function(t,e,i){var s=t("./sound-node");function o(t,e){this.context=new(window.AudioContext||window.webkitAudioContext),this.soundNodes=[],this.loader=t,this.sounds=t.sounds,this.muted=!1}o.prototype={play:function(t,e){e=void 0!==e&&e;var i=new s(this.context);if(this.sounds[t]){var o=this.sounds[t];i.setBufferData(o),i.setLoop(e),this.soundNodes.push(i),i.play()}else{var n=this;this.loader._xhrLoad(t,function(s){var o=s.response;n.context.decodeAudioData(o,function(s){n.sounds[t]=s,i.setBufferData(s),i.setLoop(e),n.soundNodes.push(i),i.play()})})}return i},setVolume:function(t){if(t<0)return console.error("無效的音量值");for(var e=0;e<this.soundNodes.length;e++){this.soundNodes[e].setVolume(t)}},mute:function(t){for(var e=0;e<this.soundNodes.length;e++){this.soundNodes[e].mute(t)}},pause:function(){this.context.suspend()},resume:function(){this.context.resume()},stop:function(){for(var t=0;t<this.soundNodes.length;t++){this.soundNodes[t].stop()}}},e.exports=o},{"./sound-node":10}],12:[function(t,e,i){var s=t("./util");function o(t){t.constructor!==String&&t.constructor!==Array||(t={costumes:[].concat(t)}),this.x=s.isNumeric(t.x)?t.x:this._settings.width/2,this.y=s.isNumeric(t.y)?t.y:this._settings.height/2,this.width=1,this.height=1,this.direction=s.isNumeric(t.direction)?t.direction:90,this.rotationStyle=t.rotationStyle||"full",this.scale=t.scale||1,this.costumes=[].concat(t.costumes),this.hidden=t.hidden||!1,this.layer=s.isNumeric(t.layer)?t.layer:0,this.opacity=s.isNumeric(t.opacity)?t.opacity:1,this.costumeId=0,this._onTickFuncs=[],this._deleted=!1,this._animation={frames:[],rate:5,timer:0},this._sprites._sprites.push(this)}o.prototype.update=function(){this._updateDirection(),this._updateFrames();for(var t=0;t<this._onTickFuncs.length;t++)this._onTickFuncs[t].call(this)},o.prototype._updateDirection=function(){this.direction=this.direction%360,this.direction<0&&(this.direction+=360)},o.prototype._updateFrames=function(){var t=this._animation;if(t.frames.length>0){var e=(new Date).getTime();e>=t.timer+1e3/t.rate&&(t.timer=e,this.costumeId=t.frames.shift(),t.frames.length<=0&&t.callback&&t.callback())}},o.prototype.moveTo=function(){if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))this.x=arguments[0].x,this.y=arguments[0].y;else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite, Cursor)或是 X, Y 座標值";this.x=arguments[0],this.y=arguments[1]}},o.prototype.move=function(t,e){this.x+=t,this.y+=e},o.prototype.stepForward=function(t){var e=s.degreeToRad(this.direction);this.x+=Math.sin(e)*t,this.y-=Math.cos(e)*t},o.prototype.bounceEdge=function(){this.x<0&&(this.x=0,this.direction>180&&this.direction>0&&(this.direction=-this.direction)),this.x>this._settings.width&&(this.x=this._settings.width,this.direction<180&&(this.direction=-this.direction)),this.y<0&&(this.y=0,(this.direction<90||this.direction>270)&&(this.direction=180-this.direction)),this.y>this._settings.height&&(this.y=this._settings.height,(this.direction>90||this.direction<270)&&(this.direction=180-this.direction))},o.prototype.toward=function(){var t,e,i,o,n;if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))t=arguments[0].x,e=arguments[0].y;else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t=arguments[0],e=arguments[1]}i=t-this.x,o=e-this.y,n=Math.atan2(i,-o),this.direction=s.radToDegree(n)},o.prototype.touched=function(){if(arguments[0].constructor===Array){for(var t=0;t<arguments[0].length;t++)if(this._isTouched(arguments[0][t]))return!0;return!1}return this._isTouched.apply(this,arguments)},o.prototype.distanceTo=function(){if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))return s.distanceBetween(this,arguments[0]);if(s.isNumeric(arguments[0])&&s.isNumeric(arguments[1]))return s.distanceBetween(this.x,this.y,arguments[0],arguments[1]);throw"請傳入角色(Sprite)、{x:x, y:y}，或是 X, Y 坐標值"},o.prototype.always=o.prototype.forever=function(t){this._onTickFuncs.push(t)},o.prototype.when=o.prototype.on=function(){var t=arguments[0],e=this._eventList;return"listen"==t?e.register(t,arguments[1],this,arguments[2]):["mousedown","mouseup","click"].includes(t)?e.register(t,this,arguments[1]):"touch"==t?e.register(t,this,arguments[1],arguments[2]):(console.log('Sprite.on() does only support "listen", "click" and "touch" events'),!1)},o.prototype.destroy=function(){this._deleted=!0},o.prototype.getCurrentCostume=function(){var t=this.costumeId;return this.costumes[t]},o.prototype.animate=function(t,e,i){this._animation={frames:t,rate:e||5,callback:i,timer:0}},o.prototype.nextCostume=function(){this.costumeId+=1,this.costumeId>=this.costumes.length&&(this.costumeId=0)},o.prototype._isTouched=function(){if(this.hidden||this._deleted)return!1;if(arguments[0]instanceof o&&((c=arguments[0]).hidden||c._deleted||c===this))return!1;if(90!=Math.abs(this.direction%180)||arguments[0]instanceof o&&!(arguments[0]instanceof o&&Math.abs(arguments[0].direction%180==90))){var t,e;if(t=Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2)),e=arguments[0]instanceof o?Math.sqrt(Math.pow(c.width/2,2)+Math.pow(c.height/2,2)):1,this.distanceTo.apply(this,arguments)>t+e)return!1;if(2*t<1||2*e<1)return!1;if(this._hitTester.clearRect(0,0,this._settings.width,this._settings.height),this._hitTester.globalCompositeOperation="source-over",arguments[0]instanceof o){var i=arguments[0].opacity;arguments[0].opacity=1,this._renderer.drawInstance(arguments[0],this._hitTester),arguments[0].opacity=i}else if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))this._hitTester.fillRect(arguments[0].x,arguments[0].y,1,1);else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite)、{x:x, y:y}，或是 X, Y 坐標值";this._hitTester.fillRect(arguments[0],arguments[1],1,1)}this._hitTester.globalCompositeOperation="source-in";i=this.opacity;this.opacity=1,this._renderer.drawInstance(this,this._hitTester),this.opacity=i,arguments[0]instanceof o?u=t<e?this._hitTester.getImageData(this.x-t,this.y-t,2*t,2*t).data:this._hitTester.getImageData(c.x-e,c.y-e,2*e,2*e).data:s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y)?u=this._hitTester.getImageData(arguments[0].x,arguments[0].y,1,1).data:s.isNumeric(arguments[0])&&s.isNumeric(arguments[1])&&(u=this._hitTester.getImageData(arguments[0],arguments[1],1,1).data);for(d=u.length,l=0;l<d;l+=4)if(u[l+3]>0)return!0}else{var n=crossY=!1;if(arguments[0]instanceof o){if(this==arguments[0])return!1;if(arguments[0].hidden)return!1;if((c=arguments[0])._deleted)return!1;n=this.x+this.width/2>c.x-c.width/2&&c.x+c.width/2>this.x-this.width/2,crossY=this.y+this.height/2>c.y-c.height/2&&c.y+c.height/2>this.y-this.height/2}else if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y)){var r=arguments[0].x,h=arguments[0].y;n=this.x+this.width/2>r&&r>this.x-this.width/2,crossY=this.y+this.height/2>h&&h>this.y-this.height/2}else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite)、{x:x, y:y}，或是 X, Y 坐標值";r=arguments[0],h=arguments[1];n=this.x+this.width/2>r&&r>this.x-this.width/2,crossY=this.y+this.height/2>h&&h>this.y-this.height/2}if(n&&crossY){var a=this._renderer;this._settings;if(!this._renderer)return console.log(this);if(hitTester=this._hitTester,hitTester.globalCompositeOperation="source-over",hitTester.drawImage(a.getImgFromCache(this.getCurrentCostume()),this.x-this.width/2,this.y-this.height/2,this.width,this.height),hitTester.globalCompositeOperation="source-in",arguments[0]instanceof o){var c=arguments[0];hitTester.drawImage(a.getImgFromCache(c.getCurrentCostume()),c.x-c.width/2,c.y-c.height/2,c.width,c.height)}else if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))hitTester.fillRect(arguments[0].x,arguments[0].y,1,1);else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))return!1;hitTester.fillRect(arguments[0],arguments[1],1,1)}for(var u,d=(u=hitTester.getImageData(this.x-this.width/2,this.y-this.height/2,this.width,this.height).data).length,l=0;l<d;l+=4)if(u[l+3]>0)return!0}}return!1},e.exports=o},{"./util":14}],13:[function(t,e,i){function s(){this._sprites=[]}s.prototype.runOnTick=function(){this.each(function(){this.update()})},s.prototype.each=function(t){for(var e=this._sprites,i=0;i<e.length;i++)t.call(e[i],e[i])},s.prototype.removeDeletedSprites=function(){for(var t=this._sprites,e=0;e<t.length;e++)t[e]._deleted&&t.splice(e,1)},s.prototype.clear=function(){this._sprites=[]},e.exports=s},{}],14:[function(t,e,i){var s={isNumeric:function(t){return!isNaN(parseFloat(t))&&isFinite(t)},radToDegree:function(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),180*t/Math.PI},degreeToRad:function(t){return(t%=360)<0&&(t+=360),t/180*Math.PI},distanceBetween:function(){var t={x:0,y:0},e={x:0,y:0};if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y)&&s.isNumeric(arguments[1].x)&&s.isNumeric(arguments[1].y))t.x=arguments[0].x,t.y=arguments[0].y,e.x=arguments[1].x,e.y=arguments[1].y;else{if(!(s.isNumeric(arguments[0])&&s.isNumeric(arguments[1])&&s.isNumeric(arguments[2])&&s.isNumeric(arguments[3])))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t.x=arguments[0],t.y=arguments[1],e.x=arguments[2],e.y=arguments[3]}return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))}};e.exports=s},{}]},{},[4]);