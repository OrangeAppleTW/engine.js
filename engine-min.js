!function t(e,i,o){function n(r,a){if(!i[r]){if(!e[r]){var h="function"==typeof require&&require;if(!a&&h)return h(r,!0);if(s)return s(r,!0);throw new Error("Cannot find module '"+r+"'")}var c=i[r]={exports:{}};e[r][0].call(c.exports,function(t){var i=e[r][1][t];return n(i||t)},c,c.exports,t,e,i,o)}return i[r].exports}for(var s="function"==typeof require&&require,r=0;r<o.length;r++)n(o[r]);return n}({1:[function(t,e,i){var o=(i=e.exports=function(t){if(t&&"object"==typeof t){var e=t.which||t.keyCode||t.charCode;e&&(t=e)}if("number"==typeof t)return r[t];var i=String(t),s=o[i.toLowerCase()];return s||((s=n[i.toLowerCase()])||(1===i.length?i.charCodeAt(0):void 0))}).code=i.codes={backspace:8,tab:9,enter:13,shift:16,ctrl:17,alt:18,"pause/break":19,"caps lock":20,esc:27,space:32,"page up":33,"page down":34,end:35,home:36,left:37,up:38,right:39,down:40,insert:45,delete:46,command:91,"left command":91,"right command":93,"numpad *":106,"numpad +":107,"numpad -":109,"numpad .":110,"numpad /":111,"num lock":144,"scroll lock":145,"my computer":182,"my calculator":183,";":186,"=":187,",":188,"-":189,".":190,"/":191,"`":192,"[":219,"\\":220,"]":221,"'":222},n=i.aliases={windows:91,"⇧":16,"⌥":18,"⌃":17,"⌘":91,ctl:17,control:17,option:18,pause:19,break:19,caps:20,return:13,escape:27,spc:32,pgup:33,pgdn:34,ins:45,del:46,cmd:91};for(s=97;s<123;s++)o[String.fromCharCode(s)]=s-32;for(var s=48;s<58;s++)o[s-48]=s;for(s=1;s<13;s++)o["f"+s]=s+111;for(s=0;s<10;s++)o["numpad "+s]=s+96;var r=i.names=i.title={};for(s in o)r[o[s]]=s;for(var a in n)o[a]=n[a]},{}],2:[function(t,e,i){function o(t){this._state="readyToStart",this._update=t}o.prototype.start=function(){if("readyToStart"===this._state){var t;this._state="running",t=function(){"running"===this._state?(this._update(),requestAnimationFrame(t)):this._state="readyToStart"}.bind(this),setTimeout(t,0)}else"stopping"===this._state&&setTimeout(start,10)},o.prototype.stop=function(){"running"===this._state&&(this._state="stopping")},e.exports=o},{}],3:[function(t,e,i){function o(t,e){this.pool=[],this.messages=[],this.io=t,this.debugMode=e||!1}function n(t,e,i,o){t.touched(i)&&(e.call(t),o&&console.log("Just fired a hover handler at: ("+i.x+","+i.y+")"))}function s(t,e,i,o){i.x&&i.y&&(t?t.touched(i.x,i.y)&&(e.call(t),o&&console.log("Just fired a click handler on a sprite! ("+JSON.stringify(i)+")")):(e(),o&&console.log("Just fired a click handler on stage! ("+JSON.stringify(i)+")")))}function r(t,e,i,o){i[t]&&(e(),o&&console.log("Just fired a keydown handler on: "+key))}function a(t,e,i,o,n){i.includes(o)&&e.call(t)}function h(t,e,i,o){for(var n,s=0;n=i[s];s++)t.touched(n)&&(e.call(t,n),o&&console.log({event:"Touch",sprite:t,target:n}))}o.prototype.traverse=function(){for(var t=this.pool,e=this.io,i=this.messages,o=this.debugMode,c=0;c<t.length;c++){if(t[c].sprite||t[c].sprites){var u=t[c].sprite||t[c].sprites[0];if("Sprite"==u.constructor.name&&u._deleted){t.splice(c,1);continue}}"hover"==t[c].event?n(t[c].sprite,t[c].handler,e.cursor,o):"click"==t[c].event?s(t[c].sprite,t[c].handler,e.clicked,o):"mousedown"==t[c].event?s(t[c].sprite,t[c].handler,e.mousedown,o):"mouseup"==t[c].event?s(t[c].sprite,t[c].handler,e.mouseup,o):"keydown"==t[c].event?r(t[c].key,t[c].handler,e.keydown,o):"keyup"==t[c].event?r(t[c].key,t[c].handler,e.keyup,o):"holding"==t[c].event?r(t[c].key,t[c].handler,e.holding,o):"listen"==t[c].event?a(t[c].sprite,t[c].handler,i,t[c].message):"touch"==t[c].event&&h(t[c].sprite,t[c].handler,t[c].targets,o)}e.clearEvents(),this._clearMessages()},o.prototype._clearMessages=function(){this.messages=[]},o.prototype.clear=function(){this.pool=[]},o.prototype.register=function(){var t=arguments[0],e={event:t,handler:arguments[arguments.length-1]};"touch"===t?(e.sprite=arguments[1],arguments[2].constructor===Array?e.targets=arguments[2]:e.targets=[arguments[2]]):["keydown","keyup","holding"].includes(t)?e.key=arguments[1]||"any":["mousedown","mouseup","click"].includes(t)?e.sprite=arguments[1]:"listen"===t&&(e.message=arguments[1],e.sprite=arguments[2]),this.pool.push(e)},o.prototype.emit=function(t){this.messages.push(t)},e.exports=o},{}],4:[function(t,e,i){var o=t("./sprite"),n=t("./sprites"),s=t("./event-list"),r=t("./inspector"),a=t("./clock"),h=t("./renderer"),c=t("./sound"),u=t("./loader"),l=t("./io"),d=t("./pen");window.Engine=function(t,e){function i(t,e,i,o,n){N.path=t,N.x=e,N.y=i,N.w=o,N.h=n}var p=document.getElementById(t),f=p.getContext("2d"),y={width:p.width,height:p.height,zoom:1,updateFunctions:[]},m=new u,g=new n,w=new r,v=new l(p,y,e),x=new s(v,e),k=new h(f,y,m.images,e),_=new c(m.sounds,e),T=new d(f),S=new a(function(){x.traverse();for(var t=0;t<y.updateFunctions.length;t++)y.updateFunctions[t]();N.path&&k.drawBackdrop(N.path,N.x,N.y,N.w,N.h),g.removeDeletedSprites(),g.runOnTick(),w.updateFPS(),k.drawSprites(g),T.draw()}),N={path:"#ffffff"};e=e||!1;var C=function(t,e,i){["keydown","keyup","mousedown","mouseup","holding","click"].includes(t)&&("function"==typeof e?x.register(t,null,e):x.register(t,e,i))},F={createSprite:function(t){var e=new o(t,x,y,k);return g._sprites.push(e),e},print:function(t,e,i,o,n,s){var r=T.fillCOlor,a=T.size;T.fillColor=o||"black",T.size=n||16,e=void 0==e?10:e,i=void 0==i?10:i,T.drawText(t,e,i,s),T.fillColor=r,T.size=a},setBackground:i,setBackdrop:i,cursor:v.cursor,key:v.holding,inspector:w,when:C,on:C,set:function(t){return t.width&&(p.width=y.width=t.width),t.height&&(p.height=y.height=t.height),t.zoom&&(y.zoom=t.zoom,p.style.width=p.width*y.zoom+"px",p.style.height=p.height*y.zoom+"px"),y.update=t.update||y.update,this},stop:function(){S.stop(),_.stop()},start:function(){S.start()},update:function(t){y.updateFunctions.push(t)},always:function(t){y.updateFunctions.push(t)},forever:function(t){y.updateFunctions.push(t)},ctx:f,clear:function(){k.clear()},preload:function(t,e,i){m.preload(t,e,i)},sound:_,broadcast:x.emit.bind(x),pen:T,drawBackdrop:function(t,e,i,o,n){k.drawBackdrop(t,e,i,o,n)},drawSprites:function(){k.drawSprites(g)}};return e&&(F.eventList=x),F}},{"./clock":2,"./event-list":3,"./inspector":5,"./io":6,"./loader":7,"./pen":8,"./renderer":9,"./sound":10,"./sprite":11,"./sprites":12}],5:[function(t,e,i){function o(){this.fps=0,this._lastFrameUpdatedTime=(new Date).getTime()}o.prototype.updateFPS=function(){var t=(new Date).getTime();this.fps=Math.round(1e3/(t-this._lastFrameUpdatedTime)),this._lastFrameUpdatedTime=t},e.exports=o},{}],6:[function(t,e,i){function o(t,e,i){var o=this.cursor={x:0,y:0,isDown:!1,left:!1,right:!1},s=this.clicked={x:null,y:null},r=this.mousedown={x:null,y:null},a=this.mouseup={x:null,y:null},h=this.keyup={any:!1},c=this.keydown={any:!1},u=this.holding={any:!1,count:0};i=i||!1,t.setAttribute("tabindex","1"),t.style.outline="none",t.oncontextmenu=function(){return!1},t.addEventListener("mousedown",function(t){1==t.which&&(o.left=!0),3==t.which&&(o.right=!0),o.isDown=!0,r.x=t.offsetX/e.zoom,r.y=t.offsetY/e.zoom}),t.addEventListener("mouseup",function(t){1==t.which&&(o.left=!1),3==t.which&&(o.right=!1),o.isDown=o.left||o.right,a.x=t.offsetX/e.zoom,a.y=t.offsetY/e.zoom}),t.addEventListener("mousemove",function(t){o.x=t.offsetX/e.zoom,o.y=t.offsetY/e.zoom}),t.addEventListener("click",function(t){s.x=t.offsetX/e.zoom,s.y=t.offsetY/e.zoom,i&&console.log("Clicked! cursor:"+JSON.stringify(o))}),t.addEventListener("keydown",function(t){var e=n(t.keyCode);u[e]||(u.any=(u.count+=1)>0),c.any=!0,c[e]=!0,u[e]=!0,i&&console.log("Keydown! key:"+e)}),t.addEventListener("keyup",function(t){var e=n(t.keyCode);u.any=(u.count-=1)>0,h.any=!0,h[e]=!0,u[e]=!1,i&&console.log("Keyup! key:"+e)})}var n=t("keycode");o.prototype.clearEvents=function(){this.clicked.x=null,this.clicked.y=null,this.mousedown.x=null,this.mousedown.y=null,this.mouseup.x=null,this.mouseup.y=null;for(var t in this.keydown)this.keydown[t]=!1,this.keyup[t]=!1},e.exports=o},{keycode:1}],7:[function(t,e,i){function o(){this.loaded=0,this.paths=[],this.sounds={},this.images={},this.completeFunc,this.progressFunc}o.prototype={preload:function(t,e,i){if(0===t.length)return e();this.paths=t,this.completeFunc=e,this.progressFunc=i;for(var o=0;o<t.length;o++){var n=t[o],s=n.split(".").pop();["jpg","jpeg","png","gif","svg"].includes(s)&&this._loadImage(n),["mp3","ogg","wav","midi"].includes(s)&&this._loadSound(n)}},_loadImage:function(t){var e=this,i=new Image;i.src=t,i.onload=function(){e._loaded()},this.images[t]=i},_loadSound:function(t){var e=this,i=new Audio;i.src=t,i.addEventListener("canplaythrough",function(){e._loaded()}),this.sounds[t]=i},_loaded:function(){this.loaded+=1,this.progressFunc&&this.progressFunc(this.loaded,this.paths.length),this.loaded===this.paths.length&&this.completeFunc&&this.completeFunc()}},e.exports=o},{}],8:[function(t,e,i){function o(t){this.ctx=t,this.size=1,this.color="black",this.fillColor=null,this.shapes=[]}o.prototype={draw:function(){for(var t,e=this.ctx,i=0;i<this.shapes.length;i++){if(t=this.shapes[i],e.lineWidth=t.size,e.strokeStyle=t.color,e.fillStyle=t.fillColor,e.beginPath(),"text"==t.type)e.textBaseline="top",e.font=t.size+"px "+t.font,e.fillText(t.t,t.x,t.y);else if("line"==t.type)e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2);else if("circle"==t.type)e.arc(t.x,t.y,t.r,0,2*Math.PI);else if("triangle"==t.type)e.moveTo(t.x1,t.y1),e.lineTo(t.x2,t.y2),e.lineTo(t.x3,t.y3);else if("rect"==t.type)e.moveTo(t.x,t.y),e.lineTo(t.x+t.w,t.y),e.lineTo(t.x+t.w,t.y+t.h),e.lineTo(t.x,t.y+t.h);else if("polygon"==t.type){e.moveTo(t.points[0],t.points[1]);for(i=2;i<t.points.length;i+=2)e.lineTo(t.points[i],t.points[i+1])}e.closePath(),t.size&&e.stroke(),t.fillColor&&e.fill()}this.shapes=[]},drawText:function(t,e,i,o){var n={};n.t=t,n.x=e,n.y=i,n.font=o||"Arial",n.type="text",this._addShape(n)},drawLine:function(t,e,i,o){var n={};n.x1=t,n.y1=e,n.x2=i,n.y2=o,n.type="line",this._addShape(n)},drawCircle:function(t,e,i){var o={};o.x=t,o.y=e,o.r=i,o.type="circle",this._addShape(o)},drawTriangle:function(t,e,i,o,n,s){var r={};r.x1=t,r.y1=e,r.x2=i,r.y2=o,r.x3=n,r.y3=s,r.type="triangle",this._addShape(r)},drawRect:function(t,e,i,o){var n={};n.x=t,n.y=e,n.w=i,n.h=o,n.type="rect",this._addShape(n)},drawPolygon:function(){var t={};t.points=Array.prototype.slice.call(arguments),t.type="polygon",this._addShape(t)},_addShape:function(t){t.size=this.size,t.color=this.color,t.fillColor=this.fillColor,this.shapes.push(t)}},e.exports=o},{}],9:[function(t,e,i){var o=t("./util");e.exports=function(t,e,i,n){function s(t){var e=r[t];return e||((e=new Image).src=t,r[t]=e),e}var r=i;this.clear=function(){t.clearRect(0,0,e.width,e.height)},this.drawSprites=function(t){t._sprites.sort(function(t,e){return t.layer-e.layer}),t.each(this.drawInstance)},this.drawInstance=function(e){if(!e.hidden){var i=s(e.getCurrentCostume());if(e.width=i.width*e.scale,e.height=i.height*e.scale,n=o.degreeToRad(e.direction-90),t.globalAlpha=e.opacity,"flipped"===e.rotationStyle){if(e.direction>180)return t.translate(2*e.x,0),t.scale(-1,1),t.drawImage(i,e.x-e.width/2,e.y-e.height/2,e.width,e.height),t.scale(-1,1),t.translate(2*-e.x,0),void(t.globalAlpha=1);n=0}if("fixed"===e.rotationStyle)var n=0;t.translate(e.x,e.y),t.rotate(n),t.drawImage(i,-e.width/2,-e.height/2,e.width,e.height),t.rotate(-n),t.translate(-e.x,-e.y),t.globalAlpha=1}},this.getImgFromCache=s,this.drawBackdrop=function(i,o,n,s,a){if(i.includes(".")){var h=r[i];h||((h=new Image).src=i,r[i]=h),t.drawImage(h,o||0,n||0,s||h.width,a||h.height)}else t.fillStyle=i,t.fillRect(0,0,e.width,e.height)}}},{"./util":13}],10:[function(t,e,i){function o(t,e){this.sounds=t,this.playing=[],this.muted=!1,this.volume=1}o.prototype={play:function(t,e){var i;return this.sounds[t]?(i=this.sounds[t].cloneNode(),this.playing.push(i),i.play()):(i=new Audio(t),this.sounds[t]=i,this.playing.push(i),i.play()),i.loop=e,i.muted=this.muted,i.volume=this.volume,i},stop:function(){for(var t=0;t<this.playing.length;t++)this.playing[t].pause();this.playing=[]},mute:function(t){this.muted=t;for(var e=0;e<this.playing.length;e++)this.playing[e].muted=t},setVolume:function(t){this.volume=t;for(var e=0;e<this.playing.length;e++)this.playing[e].volume=t},each:function(t){for(var e=0;e<this.playing.length;e++)t(this.playing[e])}},e.exports=o},{}],11:[function(t,e,i){function o(t,e,i,o){t.constructor!==String&&t.constructor!==Array||(t={costumes:[].concat(t)}),this.x=s.isNumeric(t.x)?t.x:i.width/2,this.y=s.isNumeric(t.y)?t.y:i.height/2,this.width=1,this.height=1,this.direction=s.isNumeric(t.direction)?t.direction:90,this.rotationStyle=t.rotationStyle||"full",this.scale=t.scale||1,this.costumes=[].concat(t.costumes),this.hidden=t.hidden||!1,this.layer=s.isNumeric(t.layer)?t.layer:0,this.opacity=s.isNumeric(t.opacity)?t.opacity:1,this.costumeId=0,this._onTickFuncs=[],this._deleted=!1,this._eventList=e,this._settings=i,this._renderer=o,this._animation={frames:[],rate:5,timer:0}}function n(t,e){if(this.hidden||this._deleted)return!1;var i=crossY=!1;if(arguments[0]instanceof o){if(this==arguments[0])return!1;if(arguments[0].hidden)return!1;if((l=arguments[0])._deleted)return!1;maxThisLength=Math.sqrt(Math.pow(this.width/2,2)+Math.pow(this.height/2,2)),maxTargetLength=Math.sqrt(Math.pow(l.width/2,2)+Math.pow(l.height/2,2)),this.distanceTo(l)<=maxThisLength+maxTargetLength&&(i=!0,crossY=!0)}else if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y)){var n=arguments[0].x,h=arguments[0].y;i=this.x+this.width/2>n&&n>this.x-this.width/2,crossY=this.y+this.height/2>h&&h>this.y-this.height/2}else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite)、{x:x, y:y}，或是 X, Y 坐標值";var n=arguments[0],h=arguments[1];i=this.x+this.width/2>n&&n>this.x-this.width/2,crossY=this.y+this.height/2>h&&h>this.y-this.height/2}if(i&&crossY){var c=this._renderer,u=this._settings;if(r.width=u.width,r.height=u.height,!this._renderer)return console.log(this);if(a.globalCompositeOperation="source-over",arguments[0]instanceof o){var l=arguments[0];if(d=s.degreeToRad(l.direction-90),"flipped"===l.rotationStyle)if(l.direction>180)a.scale(-1,1);else d=0;if("fixed"===l.rotationStyle)d=0;a.translate(l.x,l.y),a.rotate(d),a.drawImage(c.getImgFromCache(l.getCurrentCostume()),-l.width/2,-l.height/2,l.width,l.height),a.rotate(-d),a.translate(-l.x,-l.y)}else if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))a.fillRect(arguments[0].x,arguments[0].y,1,1);else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))return!1;a.fillRect(arguments[0],arguments[1],1,1)}a.globalCompositeOperation="source-in";d=s.degreeToRad(this.direction-90);if("flipped"===this.rotationStyle)if(this.direction>180)a.scale(-1,1);else d=0;if("fixed"===this.rotationStyle)var d=0;a.translate(this.x,this.y),a.rotate(d),a.drawImage(c.getImgFromCache(this.getCurrentCostume()),-this.width/2,-this.height/2,this.width,this.height),a.rotate(-d),a.translate(-this.x,-this.y);for(var p=Math.max(this.width,this.height),f=a.getImageData(this.x-p/2,this.y-p/2,p,p).data,y=f.length,m=0;m<y;m+=4)if(f[m+3]>0)return!0}return!1}var s=t("./util"),r=document.createElement("canvas"),a=r.getContext("2d");o.prototype.update=function(){this._updateDirection(),this._updateFrames();for(var t=0;t<this._onTickFuncs.length;t++)this._onTickFuncs[t].call(this)},o.prototype._updateDirection=function(){this.direction=this.direction%360,this.direction<0&&(this.direction+=360)},o.prototype._updateFrames=function(){var t=this._animation;if(t.frames.length>0){var e=(new Date).getTime();e>=t.timer+1e3/t.rate&&(t.timer=e,this.costumeId=t.frames.shift(),t.frames.length<=0&&t.callback&&t.callback())}},o.prototype.moveTo=function(){if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))this.x=arguments[0].x,this.y=arguments[0].y;else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite, Cursor)或是 X, Y 座標值";this.x=arguments[0],this.y=arguments[1]}},o.prototype.move=function(t,e){this.x+=t,this.y+=e},o.prototype.stepForward=function(t){var e=s.degreeToRad(this.direction);this.x+=Math.sin(e)*t,this.y-=Math.cos(e)*t},o.prototype.toward=function(){var t,e,i,o,n;if(s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y))t=arguments[0].x,e=arguments[0].y;else{if(!s.isNumeric(arguments[0])||!s.isNumeric(arguments[1]))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t=arguments[0],e=arguments[1]}i=t-this.x,o=e-this.y,n=Math.atan2(i,-o),this.direction=s.radToDegree(n)},o.prototype.touched=function(){if(arguments[0].constructor===Array){for(var t=0;t<arguments[0].length;t++)if(n.call(this,arguments[0][t]))return!0;return!1}return n.apply(this,arguments)},o.prototype.distanceTo=function(){return s.isNumeric(arguments[0].x)&&s.isNumeric(arguments[0].y)?s.distanceBetween(this,arguments[0]):s.isNumeric(arguments[0])&&s.isNumeric(arguments[1])?s.distanceBetween(this.x,this.y,arguments[0],arguments[1]):void 0},o.prototype.always=o.prototype.forever=function(t){this._onTickFuncs.push(t)},o.prototype.when=o.prototype.on=function(){var t=arguments[0],e=this._eventList;return"listen"==t?e.register(t,arguments[1],this,arguments[2]):["mousedown","mouseup","hover","click"].includes(t)?e.register(t,this,arguments[1]):"touch"==t?e.register(t,this,arguments[1],arguments[2]):(console.log('Sprite.on() does only support "listen", "click", hover" and "touch" events'),!1)},o.prototype.destroy=function(){this._deleted=!0},o.prototype.getCurrentCostume=function(){var t=this.costumeId;return this.costumes[t]},o.prototype.animate=function(t,e,i){this._animation={frames:t,rate:e||5,callback:i,timer:0}},o.prototype.nextCostume=function(){this.costumeId+=1,this.costumeId>=this.costumes.length&&(this.costumeId=0)},e.exports=o},{"./util":13}],12:[function(t,e,i){function o(){this._sprites=[]}o.prototype.runOnTick=function(){this.each(function(){this.update()})},o.prototype.each=function(t){for(var e=this._sprites,i=0;i<e.length;i++)t.call(e[i],e[i])},o.prototype.removeDeletedSprites=function(){for(var t=this._sprites,e=0;e<t.length;e++)t[e]._deleted&&t.splice(e,1)},o.prototype.clear=function(){this._sprites=[]},e.exports=o},{}],13:[function(t,e,i){var o={};o.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},o.radToDegree=function(t){return(t%=2*Math.PI)<0&&(t+=2*Math.PI),180*t/Math.PI},o.degreeToRad=function(t){return(t%=360)<0&&(t+=360),t/180*Math.PI},o.distanceBetween=function(){var t={x:0,y:0},e={x:0,y:0};if(o.isNumeric(arguments[0].x)&&o.isNumeric(arguments[0].y)&&o.isNumeric(arguments[1].x)&&o.isNumeric(arguments[1].y))t.x=arguments[0].x,t.y=arguments[0].y,e.x=arguments[1].x,e.y=arguments[1].y;else{if(!(o.isNumeric(arguments[0])&&o.isNumeric(arguments[1])&&o.isNumeric(arguments[2])&&o.isNumeric(arguments[3])))throw"請傳入角色(Sprite)或是 X, Y 坐標值";t.x=arguments[0],t.y=arguments[1],e.x=arguments[2],e.y=arguments[3]}return Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2))},e.exports=o},{}]},{},[4]);